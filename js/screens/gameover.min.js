game.GameOverScreen=me.ScreenObject.extend({init:function(){this.savedData=null;this.handler=null},onResetEvent:function(){this.savedData={score:game.data.score,steps:game.data.steps};me.save.add(this.savedData);if(!me.save.topSteps){me.save.add({topSteps:game.data.steps})}if(!me.save.topPressed){me.save.add({topPressed:game.data.pressed})}if(!me.save.topSeed){me.save.add({topPressed:game.data.initialSeed})}if(game.data.steps>me.save.topSteps){me.save.topSteps=game.data.steps;me.save.topPressed=game.data.pressed;me.save.topSeed=game.data.initialSeed;game.data.newHiScore=true}me.input.bindKey(me.input.KEY.SPACE,"enter",false);this.handler=me.event.subscribe(me.event.KEYDOWN,function(e,f,d){if(e==="enter"){me.state.change(me.state.MENU)}});var c=new me.Sprite(me.game.viewport.width/2,me.game.viewport.height/2,{image:"gameoverbg"});var c=new me.Sprite(me.game.viewport.width/2,me.game.viewport.height/2,{image:"gameoverbg"});me.game.world.addChild(c,10);me.game.world.addChild(new BackgroundLayer("bg",1));this.fence1=me.pool.pull("fence",0,me.game.viewport.height-100,4);this.fence2=me.pool.pull("fence",me.game.viewport.width,me.video.renderer.getHeight()-100,4);me.game.world.addChild(this.fence1,11);me.game.world.addChild(this.fence2,11);var a=this;this.dialog=new (me.Renderable.extend({init:function(){this._super(me.Renderable,"init",[0,0,me.game.viewport.width/2,me.game.viewport.height/2]);this.yourScoreFont=new me.Font("gamefont",20,"white","center");this.scoreFont=new me.Font("gamefont",40,"white","center");this.highScoreFont=new me.Font("gamefont",20,"white","center")},draw:function(e){var d=this.scoreFont.measureText(e,game.data.steps.toFixed(2));this.scoreFont.draw(e,game.data.steps.toFixed(2),me.game.viewport.width/2+d.width/2+40,me.game.viewport.height/2+50);this.highScoreFont.draw(e,"High score: "+me.save.topSteps.toFixed(2),me.game.viewport.width/2+d.width,me.game.viewport.height/2+120)}}));me.game.world.addChild(this.dialog,12);this.restart=new me.pool.pull("restart_button",300,400);me.game.world.addChild(this.restart,14);var b=me.Renderable.extend({init:function(d,h,f,g){var e=me.device.getPixelRatio();if(e>1){d=(d/e);h=(h/e)}this.$input=$('<input type="image" id="enterCompNative" src="/wp-content/plugins/velocity-game/data/img/enter_comp_button.png">').css({left:d,top:h});if(e>1){this.$input.css({width:220/e,height:34/e})}this.$input.click(a.submitResults.bind(a));switch(f){case"text":this.$input.attr("maxlength",g).attr("pattern","[a-zA-Z0-9_-]+");break;case"number":this.$input.attr("max",g);break}$(me.video.getWrapper()).append(this.$input)},destroy:function(){this.$input.remove()}});this.enterCompNative=new b(514,413);me.game.world.addChild(this.enterCompNative,14)},submitResults:function(){var a=this;FB.getLoginStatus(function(b){a.statusChangeCallback(b)});return false},statusChangeCallback:function(b){var a=this;if(b.status==="connected"){a.doSubmitScores()}else{FB.login(function(c){if(c.status==="connected"){a.doSubmitScores()}else{alert("You need to be logged in to facebook to submit your score!")}},{scope:"email"})}},doSubmitScores:function(){FB.api("/me?fields=id,name,email",function(a){$.ajax({type:"POST",url:wpAjaxUrl,data:{action:"submit_game_score",name:a.name,email:a.email,personid:a.id,seed:me.save.topSeed,data:JSON.stringify(me.save.topPressed),score:me.save.topSteps},success:function(b){alert("Your high score has been submitted, good luck!")},error:function(){alert("Sorry, there was an error submitting your score!")}})})},onDestroyEvent:function(){me.event.unsubscribe(this.handler);me.input.unbindKey(me.input.KEY.SPACE);this.fence1=null;this.fence2=null;this.font=null;this.tweet=null;this.restart=null;this.gameOverBG=null}});